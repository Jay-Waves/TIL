# 替换
`:s/OLD_WORD/NEW_WORD/g`

- g(global): 全局变量, ==仅指对一行的全局,比如一行有好几个时同时替换,不能跨行==
- c: 是否确认
- 其中字符可以使用正则表达式， 比如使用\<匹配单词开头， 使用\>匹配单词结尾
- i表示大小写不敏感，I反之

## 定址
#### 替换全部
`:%s/OLD/NEW/g`
1. `%`等价于`1, $`, 选定部分区域代指`:'<,'>`, 也同样可以使用行号区间表示`n,ms/OLD/NEW/g`
2. 在s前加参数`begin,end s`指跨行从begin到end进行查找, g指一行所有(而非第一个, 即vim默认操作都是以行为单位的, 不加g是匹配第一个, 加g是匹配当前范围中的所有. 当前范围可以加%从一行改为全部文本)
3. 可以使用正则表达式， 具体见*正则表达式目录*

#### 行定址
`:n,ms///`, 其中n和m是数字, 或者是[[查找与替换#表示位置的符号|位置替换符号]].

#### 模式匹配
- 向前向后查找:
1. `?^Chapter?`向前查找前一个行首(^)的chapter
2. `/^Chapter/` 向后查找前一个行首(^)的chapter
3. 此时避免混淆可以使用`=`或`+`替换`/`

如: `:?^Chapter?, /^Chapter/s=grey=gray=g`

- 模式匹配指定范围:

使用某模式的前一行: `/Chapter/-1`
定位匹配点下的第二行: `/Chapter/+2`

例如: `:+3,$-5` 指定当前行下面的第三行道文件末倒数第五行的范围.

## 示例
1.  在某函数中替换循环步长i为j
- 匹配*孤立i*, 如`int i, for(i, )`等: 先v选中后, 用`$: s/\<i\>/j/g`
- 匹配数组下标i, 用`s/\[i\]\[j]\g`, 注意g用于同行多选,替换为的文本不是正则不需转义

## **文本学习替换**
`:ab email xxxx@gmail.com`
之后编辑模式下,会将`email`自动替换为`xxxx@gmail.com`. 也就是定义了一个唤起前缀

# 查找
`/{target}`

- 区分大小写：
1. 不区分大小写`:set ic`
2. 取消1中操作`:set noic`


## 大小写转换
- `~` 改变大小写
- `g~~`改变当前行大小写， 其中~代表取反，U代表大写，u代表小写。

例子：
1. `gu3w`改变后续三个单词为小写。

***
# 全局定位global

匹配模式和s命令相似
> 见 [[移动/快速移动#global命令]]

***

# 扩展: s命令正则表达式
#正则表达式

### 元字符

元字符是具有特殊意义的字符。使用元字符可以表达**任意字符**、**行首**、**行 尾**、**某几个字符**等意义。

**元字符一览**

| 元字符 | 说明 |
| --- | --- |
| **.** | 匹配任意一个字符 |
| **\[abc\]** | 匹配方括号中的任意一个字符。可以使用-表示字符范围，如`[a-z0-9]`匹 配小写字母和阿拉伯数字。注意可以使用`\|`符号表示"或"|
| **\[^abc\]** | 在方括号内开头使用 **^** 符号，表示匹配除方括号中字符之外的任意字符。 |
| **\\d** | 匹配阿拉伯数字，等同于 **\[0-9\]** 。 |
| **\\D** | 匹配阿拉伯数字之外的任意字符，等同于 **\[^0-9\]**。 |
| **\\x** | 匹配十六进制数字，等同于 **\[0-9A-Fa-f\]**。 |
| **\\X** | 匹配十六进制数字之外的任意字符，等同于 **\[^0-9A-Fa-f\]**。 |
| **\\w** | 匹配单词字母，等同于 **\[0-9A-Za-z\_\]**。 |
| **\\W** | 匹配单词字母之外的任意字符，等同于 **\[^0-9A-Za-z\_\]**。 |
| **\\t** | 匹配\<TAB>字符。 |
| **\\s** | 匹配空白字符，等同于 **\[ \\t\]** 。 |
| **\\S** | 匹配非空白字符，等同于 **\[^ \\t\]** 。 |

##### 特殊匹配
- 匹配换行符 `/one\ntwo`
- 如果one和two之间还有额外的空格 `/one\_stwo` (这表示匹配一个空格或一个换行符); 若要允许任意数量的空格 `/one\_s\+two`. `\_`可以加在很多模式前, 用来额外匹配换行符.(如`\_.`匹配任意字符和一个换行符, `\_.*`匹配所有字符直到文件结束)

##### 转义

另外，如果要查找字符 \*、.、/等，则需要在前面用 **\\** 符号，表示这不是元字符，而只是普通字符而已。

| 元字符 | 说明 |
| --- | --- |
| **\\\*** | 匹配 \* 字符。 |
| **\\.** | 匹配 . 字符。 |
| **\\/** | 匹配 / 字符。 |
| **\\\\** | 匹配 \\ 字符。 |
| **\\\[** | 匹配 \[ 字符。 |

##### 表示数量的元字符

| 元字符      | 说明                                                        |
| ----------- | ----------------------------------------------------------- |
| **\***      | 匹配0-任意个                                                |
| **\\+**     | 匹配1-任意个                                                |
| **\\?**     | 匹配0-1个                                                   |
| **\\{n,m}** | 匹配n-m个                                                   |
| **\\{n}**   | 匹配n个                                                     |
| **\\{n,}**  | 匹配n-任意个                                                |
| **\\{,m}**  | 匹配0-m个                                                   |
| `\=`        | 匹配可选项, 如`folders\=`匹配folder和folders. 等同于\{0, 1} |
| `\|`        | "或", 可以加上区域标识:`\(\|\)`                                                       | 

- 匹配尽可能少:

使用`\{-n, m}`
如: `/a.\{-}b`匹配`axbxb`中的`axb`, 但是`/a.*b`会匹配`axbxb`

##### 表示位置的符号

| 元字符 | 说明 |
| --- | --- |
| **$** | 匹配行尾 |
| **^** | 匹配行首 |
| \\< | 匹配单词词首 |
| \\> | 匹配单词词尾 |


**使用例**

```
/char\s\+[A-Za-z_]\w*;                 " 查找所有以char开头，之后是一个以上的空白，                                             " 最后是一个标识符和分号/\d\d:\d\d:\d\d                        " 查找如 17:37:01 格式的时间字符串:g/^\s*$/d                             " 删除只有空白的行:s/\<four\>/4/g                        " 将所有的four替换成4，但是fourteen中的four不替换
```

### 替换变量

在正规表达式中使用 **\\(** 和 **\\)** 符号括起正规表达式，即可在后面使用**\\1**、**\\2** 等变量来访问 **\\(** 和 **\\)** 中的内容。括号用法和正则表达式相同, 但是要加额外的`\`, 因为正则表达式没有扩展.
`\0`可以使用匹配的整个内容

> 注意, 常规正则表达式用法:
> 用`()`匹配组, 用`\num`获取匹配

**使用例**

```
/\(a\+\)[^a]\+\1                                          " 查找开头和结尾处a的个数相同的字符串，                                                                  " 如 aabbbaa，aaacccaaa，但是不匹配 abbbaa
:s/\(http:\/\/[-a-z\._~\+%\/]\+\)/<a href="\1">\1<\/a>/   " 将URL替换为<a href="http://url">http://url</a>的格式
:s/\(\w\+\)\s\+\(\w\+\)/\2\t\1                            " 将 data1 data2 修改为 data2 data1
```

### 函数式

在替换命令 **s///** 中可以使用函数表达式来书写替换内容，格式为

```
:s/替换字符串/\=函数式
```

在函数式中可以使用 submatch(1)、submatch(2) 等来引用 **\\1**、**\\2** 等的内容，而submatch(0)可以引用匹配的整个内容。

**使用例**

```
:%s/\<id\>/\=line(".")                              " 将各行的 id 字符串替换为行号
:%s/^\<\w\+\>/\=(line(".")-10) .".". submatch(1)    " 将每行开头的单词替换为 (行号-10).单词 的格式，                                                           " 如第11行的 word 替换成 1. word
```

`\=`
如:
1. `printf()`
2. `submatch()`
3. `line()`