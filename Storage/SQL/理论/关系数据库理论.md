关系模式五元组: $R(U, D, Dom, F)$
- 关系名 R
- U 为一组属性
- D 属性组 U 所来自的域
- Dom 为属性到域的映射
- F 为属性组 U 上的一组数据依赖 (约束关系)

简化为 $R(U,\ F)$, 其实例(某个关系)记为 r, r 包括很多数据元组 t.

# 定义

数据依赖包括: 函数依赖 (Functional Dependency, FD), 多值依赖 (Multi-Valued Dependency, MVD)

## 函数依赖

属性集 $X, Y$, 对 r 上**任意**两个元组 $t_{1}, t_{2}$: 如果 $t_{1}[X]=t_{2}[X]\Rightarrow t_{1}[Y]=t_{2}[Y]$, 则 $X\rightarrow Y$ (Y函数依赖于X)

若 $X\rightarrow Y$, $Y\rightarrow X$, 则记为 $X\leftarrow \rightarrow Y$

若 Y 不函数依赖于 X, 记为 $X\not\rightarrow Y$

若 $X\rightarrow Y$, 且对于 X 的任意真子集 $X'$, 都有 $X'\not\rightarrow Y$, 则称 Y 对 X 完全函数依赖, 记为 $X\stackrel{F}{\longrightarrow}Y$; 若 $X\rightarrow Y$, 且 Y 不完全函数依赖于 X, 则称 Y 对 X 部分函数依赖, 记为 $X\stackrel{P}{\longrightarrow}Y$

$R(U)$ 中, 如果 $X\leftarrow Y$, $Y\not\subseteq X$, $Y\not\leftarrow X$; $Y\leftarrow Z$, $Z\not\subseteq Y$, 则称 Z 对 X 传递函数依赖 (transitive functional dependency), 记 $X\stackrel{传递}{\longrightarrow}Z$. 如果 $Y\leftarrow \rightarrow X$, 则 Z 直接依赖于 X, 而不是传递依赖. **传递依赖村子啊非受控冗余**

## 多值依赖

多值依赖包括函数依赖, 

## 码/键 key

设 K 为 $R(U,\ R)$ 中的属性或属性组合, 若 $K\stackrel{F}{\rightarrow} U$, 则称K为R的一个**候选码 (candidate key)**. 从关系模式R中选出一个K, 来作为主码 (primary key).
- 如果 $K\stackrel{P}{\rightarrow}U$, 则称 K 为超码 (Surpkey)
- 候选码是最小的超码, 即 $K\stackrel{F}{\rightarrow}U$

包含在任何一个候选码中的属性, 称为**主属性** (Prime attribute), 不包含在任何候选码中的属性称为**非主属性** (Nonprime attribute) 或非码属性 (Non-key attribute)

R整个属性组是码, 称为全码(All-key)

属性组X并非R的主码, 但是是另一个模式的主码, 则称X为R的**外码 (Foreign Key)**.

## Armstrong 公理系统

对于关系模式 $R(U,\ F)$, 其任何一个关系r, 若 $X\rightarrow Y$ 皆成立, 则称 F 蕴含 $X\rightarrow Y$.

对于 $R(U,\ F)$ 存在如下推理规则:
- A1自反律 (reflexivity rule) 若 $Y\subseteq X\subseteq U$, 则 $X\rightarrow Y$ 为F所蕴含.
- A2增广律 (augmentation rule) 若 $X\rightarrow Y$ 为F所蕴含, 且 $Z\subseteq U$, 则 $XZ\rightarrow YZ$ 为F所蕴含.
- A3传递律 (transitivity rule) 若 $X\rightarrow Y$, $Y\rightarrow Z$ 为F所蕴含, 则 $X\rightarrow Z$ 为F所蕴含.

引理:
- 合并规则 (union rule) 若 $X\rightarrow Y$, $X\rightarrow Z$, 则 $X\rightarrow YZ$
- 伪传递规则 (pseudo transitivity rule) 若 $X\rightarrow Y$, $WY\rightarrow Z$, 则 $XW\rightarrow Z$
- 分解规则 (decomposition rule) 若 $X\rightarrow Y$, $Z\subseteq Y$, 则 $X\rightarrow Z$

## 范式

范式 (Normal Form, NF) 是符合某一种级别的关系模式的集合. 如关系模式R是第二范式, 记为 $R\in 2NF$

$5NF\in 4NF\in BCNF\in 3NF\in 2NF\in 1NF$, 处于低级范式的关系模式, 通过模式分解 (schema decomposition) 转化为若干个高一级范式的关系模式集合, 该过程称为**规范化 Normalization**, 随着范式等级提高, 数据冗余减少, 但数据库结构复杂性和维护难度也提高.
- 第一范式 1NF: 每一列都是原子性的, 不可再分割; 且每行(每条记录)都是唯一的.
- 第二范式 2NF: 去除"非主属性对候选键的部分依赖"
- 第三范式 3NF: 去除"非主属性对候选键的传递依赖", 去除大部分非主属性之间的依赖关系.
- BC 范式 BCNF: 去除"主属性之间的部分依赖关系", 或"主属性对候选键的传递依赖关系."
- 第四范式 4NF: 去除"非平凡且非函数依赖的多值依赖", 达到平凡的多值依赖.
- 第五范式 5NF: (完全规范化), 消除表中连接依赖.

**依次去除所有不依赖候选键的函数依赖**

### 1NF

表的每一属性都是不可分割的最小数据单位, 且关系中的每一元组都是唯一的.

### 2NF

若关系模式 $R\in 1NF$, 每个*非主属性*都完全依赖于*任何一个候选码*, 则$R\in 2NF$.

如果是单一候选键, 一定符合 2NF.

### 3NF

